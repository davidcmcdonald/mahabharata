:root{--bg:#faf7f0;--fg:#1f2328;--muted:#6a6f76;--card:#ffffff;--accent:#c85b31;--chip:#efe7dd;--link:#7c5b2e}
*{box-sizing:border-box}
body{margin:0;font:16px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial;color:var(--fg);background:var(--bg)}
header{position:sticky;top:0;z-index:5;background:linear-gradient(#fff,rgba(255,255,255,.92));box-shadow:0 1px 0 rgba(0,0,0,.06)}
.wrap{max-width:1200px;margin:0 auto;padding:16px}
h1{margin:0 0 6px;font-size:26px}
.toolbar{display:grid;grid-template-columns:1.2fr .8fr .8fr .8fr auto auto;gap:10px;align-items:center}
.chapbar{display:grid;grid-template-columns:auto 1fr auto auto auto;gap:10px;align-items:center;margin-top:10px}
.chk{display:flex;align-items:center;gap:6px}
input,select,button{width:100%;padding:10px 12px;border:1px solid #d8d8d8;border-radius:10px;background:#fff}
input[type="search"]{padding-left:38px}
input[type="range"]{padding:0;height:36px}
.searchbox{position:relative}
.searchbox svg{position:absolute;left:10px;top:50%;transform:translateY(-50%);opacity:.5}
.pill{background:var(--accent);color:#fff;border:0;border-radius:10px;padding:10px 14px;cursor:pointer}
.pill.secondary{background:#fff;color:#1f2328;border:1px solid #d8d8d8}
.chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.chip{padding:6px 9px;border-radius:999px;background:var(--chip);border:1px solid #e5ded3;font-size:12px}
#grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-top:14px}
@media (max-width:980px){#grid{grid-template-columns:repeat(2,1fr)}}
@media (max-width:640px){.toolbar{grid-template-columns:1fr} #grid{grid-template-columns:1fr} .chapbar{grid-template-columns:1fr}}
.card{background:var(--card);border:1px solid #ebe5da;border-radius:16px;box-shadow:0 4px 10px rgba(0,0,0,.04);overflow:hidden;display:flex;gap:12px;padding:12px;transition:box-shadow .2s,border-color .2s}
.card.hit{box-shadow:0 0 0 3px rgba(200,91,49,.7), 0 12px 20px rgba(0,0,0,.08);border-color:#c85b31}
.avatar{width:72px;height:72px;border-radius:12px;object-fit:cover;border:1px solid #eae2d7;background:#f2ece3}
.title{font-weight:700}
.aka{color:var(--muted);font-size:12px}
.meta{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0}
.tag{font-size:11px;padding:4px 7px;border:1px solid #e9e1d6;border-radius:8px;background:#f9f5ee}
.rel{font-size:12px;color:#3a3f44}
.notes{font-size:13px;color:#2e3237}
.muted{color:var(--muted)}
.badges{display:flex;gap:6px;flex-wrap:wrap;margin-top:6px}
.badge{font-size:11px;padding:3px 7px;border-radius:999px;border:1px solid #e3dccf;background:#fff}
/* Tree */
#treePane{display:none;margin-top:12px;border:1px solid #ebe5da;border-radius:16px;background:#fff;overflow:hidden}
#treeToolbar{display:flex;gap:8px;align-items:center;padding:10px;border-bottom:1px solid #eee;background:#fff}
#tree{width:100%;height:800px}
.node rect{fill:#fffaf0;stroke:#ad8b56;stroke-width:2;rx:12;ry:12}
.node .name{font-weight:700}
.node .role{font-size:12px;fill:#6a6f76}
.link{fill:none;stroke:#7c5b2e;stroke-width:2;opacity:.75}
.legend{display:flex;gap:10px;flex-wrap:wrap;font-size:12px;padding:8px 12px}
.legend span{display:inline-flex;align-items:center;gap:6px}
.dot{width:10px;height:10px;border-radius:50%}